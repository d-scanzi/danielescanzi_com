<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.3.450">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Daniele Scanzi">
<meta name="dcterms.date" content="2024-10-14">
<meta name="description" content="Reflections on the difference between participants and subjects in research">

<title>~/Daniele-Scanzi - Stop treating participants as passive subjects</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
</style>


<script src="../../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../../site_libs/quarto-search/fuse.min.js"></script>
<script src="../../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../../">
<script src="../../site_libs/quarto-html/quarto.js"></script>
<script src="../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../../site_libs/quarto-html/anchor.min.js"></script>
<link href="../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" class="quarto-color-scheme" id="quarto-text-highlighting-styles">
<link href="../../site_libs/quarto-html/quarto-syntax-highlighting-dark.css" rel="stylesheet" class="quarto-color-scheme quarto-color-alternate" id="quarto-text-highlighting-styles">
<script src="../../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" class="quarto-color-scheme" id="quarto-bootstrap" data-mode="light">
<link href="../../site_libs/bootstrap/bootstrap-dark.min.css" rel="stylesheet" class="quarto-color-scheme quarto-color-alternate" id="quarto-bootstrap" data-mode="dark">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>


<link rel="stylesheet" href="../../styles.css">
</head>

<body class="nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg navbar-dark ">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container">
    <a class="navbar-brand" href="../../index.html">
    <span class="navbar-title">~/Daniele-Scanzi</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
  <li class="nav-item">
    <a class="nav-link" href="../../projects/projects_intro.html" rel="" target="">
 <span class="menu-text">Projects</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../exploring/exploring_intro.html" rel="" target="">
 <span class="menu-text">Exploring</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../educating/educating_intro.html" rel="" target="">
 <span class="menu-text">Educating</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../posts.html" rel="" target="">
 <span class="menu-text">Posts</span></a>
  </li>  
</ul>
            <div class="quarto-navbar-tools">
  <a href="" class="quarto-color-scheme-toggle quarto-navigation-tool  px-1" onclick="window.quartoToggleColorScheme(); return false;" title="Toggle dark mode"><i class="bi"></i></a>
</div>
          </div> <!-- /navcollapse -->
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Stop treating participants as passive subjects</h1>
  <div class="quarto-categories">
    <div class="quarto-category">opinions</div>
    <div class="quarto-category">academia</div>
  </div>
  </div>

<div>
  <div class="description">
    Reflections on the difference between participants and subjects in research
  </div>
</div>


<div class="quarto-title-meta">

    <div>
    <div class="quarto-title-meta-heading">Author</div>
    <div class="quarto-title-meta-contents">
             <p>Daniele Scanzi </p>
          </div>
  </div>
    
    <div>
    <div class="quarto-title-meta-heading">Published</div>
    <div class="quarto-title-meta-contents">
      <p class="date">October 14, 2024</p>
    </div>
  </div>
  
    
  </div>
  

</header>

<p>During my undergrad I spent lots of time learning about classical psychological experiments, like the <a href="https://www.simplypsychology.org/wp-content/uploads/zimbardo-paper.pdf">Stanford Prison Experiment</a> or the <a href="https://psycnet.apa.org/doiLanding?doi=10.1037%2Fh0040525">Milgram’s Experiment</a>. These are influential studies not only for the role they played in the psychological discussion but for their impact on the ethics of science. These experiments potentially created undue distress (this is an understatement for the Stanford Experiment) in the participants, which resulted in the introduction of stricter and stricter ethical protocols. As a researcher (for legal reasons I need to say I am a PhD student), I see the effects of our past every time I start a new study. A lengthy ethics form must be filled, highlighting, among other things, all the steps I will take to avoid inducing unjustified distress to those who voluntarily participate in my research.</p>
<p>Although filling out lengthy and repetitive paperwork causes me distress, being forced to think about how I will protect the participants’ privacy, acquire informed consent, and ensure everyone is informed and comfortable being in the study is important. It reminds you that part of your job as a researcher is “customer service” - you work with people. Not only do you work with people, but people work for you. For whatever reason, people decide to engage in scientific studies. They offer some of their free time and effort to complete our studies, without asking anything back except for the experience and a 20$ voucher.</p>
<p>With all these considerations, I always try to make the experimental experience an enjoyable time. My studies are already quite boring (cognitive neuroscience of vision and attention sound cool until you sit in front of a computer looking at a square for an hour), and EEG requires a certain level of proximity, especially when we need to touch your head and face to apply the electrodes. Therefore, the first thing I usually do is get to know the person in front of me, run them through what’s going to happen, make sure they are fine with it, and have small talk whenever possible. This is a collaborative moment, and I want to have a nice relationship with my collaborators.</p>
<p>I have never consciously thought much about all of this until one day. One day, I started preparing my data to be stored in <a href="https://bids.neuroimaging.io/">BIDS</a> format. Specifically, I was converting the file names into the required standard <em>sub-0X_task</em>, and it hit me. Do you see? Do you see what’s happening? The standard is to use sub, <em>subject</em>, and not <em>participant</em>. Ok, now that I have written this down, I realise it doesn’t seem much, but bear with me and let’s go down this rabbit hole together.</p>
<p>The <a href="https://www.merriam-webster.com/dictionary/subject">Merriam-Webster</a> dictionary define <em>subject</em> as:</p>
<blockquote class="blockquote">
<p>one that is placed under authority or control</p>
</blockquote>
<p>It implies subordination, hierarchy, passivity. <em>Subject</em> is a term that captures the views and beliefs that underlie studies like the Stanford Prison and Milgram’s experiments. A <em>subject</em> is someone that you can use to collect data for your research. You, the researcher, are the one offering a unique opportunity to see how science works. And they, the <em>subjects</em>, are better off taking this opportunity because the greater cause of science needs their data. Don’t think twice, don’t complain, just come and do your part.</p>
<p>OK, OK, maybe that was an overreaction. “Or was it?” (Vsauce, anytime). Something about that initially seemingly insignificant difference between the two words made me pay more attention to how researchers talk about participants and behave with them. And well, researchers like <em>subjects</em>. The first thing I noticed was a somewhat widespread feeling that dealing with participants was annoying. It is so annoying that in some more funded universities, primary researchers do not even have to interact with them directly. Research assistants, usually undergrad and grad students, do the work for them. Everything the researcher sees is the stream of data they are provided with. The idea is that data collection is not a high-priority step in the study. It takes time from other more important activities, like writing as many papers as you can because “you publish or perish”, or understanding how to use statistics to fix a bug in the experiment, a bug that no one caught on time because those in charge were writing as many articles as they could… Obviously, the students collecting data do not necessarily end up as authors on the papers because spending time with participants and creating datasets is clearly not a necessary step in the research process. I’m sure we all agree with that.</p>
<p>In this view, a <em>subject</em> is an entity that is detached from the study. Although no cognitive neuroscience or psychology experiment would be done without their time and work, they are seen just as a source of data. This view is similar to how big AI companies see content creators (writers, YouTubers, photographers, actors, etc… ) as a necessity whose work should be exploited with disinterest. Because <em>subjects</em>’s data is necessary, it’s annoying when they do not turn up for an experiment, even though the consent form we provide states that they are free to withdraw whenever. But researchers can be late for a session (you know, all those papers to write) and that’s fine. I saw cases of people being left waiting for their session for over an hour. But this is all good, <em>subjects</em> are entities and entities have no concept of time or work to do.</p>
<p>A related issue is the idea of interpersonal relationship some researchers have if they are so unlucky to have to collect their own data. There is no need to talk to <em>subjects</em> to make them feel comfortable, welcomed and/or interested. You just recite some protocol detailing the necessary information for the session, and that’s pretty much it. In an EEG study, this means that the <em>subject</em> will sit mostly in silence for anywhere between 15 and 45 minutes while the researcher is touching their head and staying close to them. We can all agree that nothing relaxes more than a stranger touching your head for a prolonged period of time. This type of researcher-<em>subject</em> relationship seems to be rooted in the idea of science engagement as a business transaction. It requires formality. It requires professionalism. It requires awkward silence. To me, this is simply unacceptable. If dentists try to do small talk to keep us comfortable when they are chucking their fingers in our mouths, I’m sure we can do the same. The small talk, no the fingers part.</p>
<p>Probably the most telling issue on this topic is the amount of time and money researchers spend trying to optimise data collection. The standard practice is through some flyers displayed around the university - cheap and easy. But this is not enough. Flyers won’t attract the masses, the story goes. We need other tools. We need other ways that maximise the capital gain in <em>subjects</em> and minimise the time frame of data collection. And what we came up with? Course credits for completing a learning experience module. The idea is simple. A university is full of students. If we encourage them to participate in studies, we can collect data at a fast rate. But you know what’s even better? We can also avoid reimbursing them with money or vouchers! The only thing we need to do is to tell them that part of their course credits is obtained by participating in one or more studies<a href="#fn1" class="footnote-ref" id="fnref1" role="doc-noteref"><sup>1</sup></a>. Researchers save money and students learn something through a practical activity. Unless they don’t. I cannot remember participating in a study where I truly learned something. True, the experience might be interesting. You can see some cool equipment, but in most cases, the learning component stops there. As researchers, we can show you something, like the differences in your EEG when you keep your eyes open or closed, or we can give you a picture of your fMRI brain scan. But for most people, these are interesting things that mean nothing. Seeing a wiggly line on a screen is exciting if you know its meaning and implications. A picture of your brain is a nice token, but is it a learning component? I’d say no. The issue is exacerbated by the points discussed above, by the treatment of <em>participants</em> as <em>subjects</em>. If data collection is always delegated to research assistants, they might not know the background details of the study, meaning that they might be unable to provide more insight into the reason for the study. If the leading researchers are uninterested in properly collaborating with the participants, they create an environment that does not support participants asking questions they are interested in.</p>
<p>The sad part of this situation is that, from personal experience, most <em>participants</em> are truly interested in what they are doing in a study, even when the study is tedious or requires many different sessions. And this is the core issue I have with the <em>subject</em> mentality. It fails people who engage with science. The people who play an essential part in human research. There is considerable discussion and pressure within the scientific community to perform more community engagement. Science needs to connect more with people who are not necessarily part of the scientific community. Scientists need to be able to communicate the meaning of their research so that everyone can understand what they do. However, this pressure is mainly expressed in words and implemented in policies but is not necessarily enforced. The situation is one where researchers express in ethics applications, grant proposals, and other documents how well <em>participants</em> will be treated, how much they will learn from engaging in a study, how good a study is for the community. However, the sentiment is not expressed in a change of research culture. <em>Participants</em> are seen as <em>subjects</em>, and they are treated as such.</p>
<p>I understand that this is a multifaceted problem that encompasses many other academic issues. Researchers are dealing with low funds, extreme pressure to publish “innovative” research, time constraints, low or non-existent wages, and extreme competition. In my view, these issues begin at the higher levels of academia and trickle down to researchers (PhD, master and undergrad students). However, we should not let them trickle down even further, down to people who want to help science out of their free time. Not only this, these issues are not an excuse for treating people as <em>subjects</em>. We researchers really need to think hard about how we treat the people who participate in our study. A first step is to realise that we are not the most important element in the research room. Yes, we hold the responsibility for the safety and well-being of the other person, but they are our collaborators. Our co-pilots for the duration of the study. We provide the needed guidance, and they collaborate with us to complete the research task. As such, we need to create an environment with a flat power-gradient<a href="#fn2" class="footnote-ref" id="fnref2" role="doc-noteref"><sup>2</sup></a>. An environment that is friendly and welcoming and makes people comfortable not only with being there but also with asking questions, making comments, or simply getting to know each other for a moment. If we truly believe in what we write on official documents, we need to start to behave accordingly.</p>
<hr>
<p><strong><em>The post image was generated through <a href="https://openai.com/index/dall-e-3/">DALL-E</a>. The content was written without the use of generative AI systems. <a href="https://app.grammarly.com/">Grammarly</a> which was used to spell-check the final document.</em></strong></p>




<div id="quarto-appendix" class="default"><section id="footnotes" class="footnotes footnotes-end-of-document" role="doc-endnotes"><h2 class="anchored quarto-appendix-heading">Footnotes</h2>

<ol>
<li id="fn1"><p>The situation is actually worse. Students can choose whether to participate in studies or write a short essay. The topic and related material are provided by the researchers who also grade the essays. The problem is that researchers are not paid for this, meaning that they are doing course marking for free and for a course they don’t even know. If you want to know more, look up the <a href="https://www.sona-systems.com/">SONA System</a>. Already the homepage statement on participation rates and the prices hidden behind a call-to-action capture the marketing and capitalistic view of science.<a href="#fnref1" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn2"><p>The topic of a flat power-gradient is an interesting one in academia. It plays an essential role in class, where the passive view encapsulated by <em>subjects</em> is translated into the passive view some educators have of students. The view of educators (professors, teaching assistants, techs, etc…) playing the most important role in a class is pretty much still alive, meaning that students are seen as an entity that should quietly listen to anything it is told to. I not only see this happening in some classes and tutorials, but it is also evident in the way the university administrators run universities. As a business whose primary goal is to maximise some random rankings at the expanses of the tuition paid by students. Much could be said about the ways universities have been reducing the number of teaching roles, diminishing the educational offer to students while increasing tuition prices, university accommodation rents, etc…<a href="#fnref2" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
</ol>
</section></div></main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const disableStylesheet = (stylesheets) => {
    for (let i=0; i < stylesheets.length; i++) {
      const stylesheet = stylesheets[i];
      stylesheet.rel = 'prefetch';
    }
  }
  const enableStylesheet = (stylesheets) => {
    for (let i=0; i < stylesheets.length; i++) {
      const stylesheet = stylesheets[i];
      stylesheet.rel = 'stylesheet';
    }
  }
  const manageTransitions = (selector, allowTransitions) => {
    const els = window.document.querySelectorAll(selector);
    for (let i=0; i < els.length; i++) {
      const el = els[i];
      if (allowTransitions) {
        el.classList.remove('notransition');
      } else {
        el.classList.add('notransition');
      }
    }
  }
  const toggleColorMode = (alternate) => {
    // Switch the stylesheets
    const alternateStylesheets = window.document.querySelectorAll('link.quarto-color-scheme.quarto-color-alternate');
    manageTransitions('#quarto-margin-sidebar .nav-link', false);
    if (alternate) {
      enableStylesheet(alternateStylesheets);
      for (const sheetNode of alternateStylesheets) {
        if (sheetNode.id === "quarto-bootstrap") {
          toggleBodyColorMode(sheetNode);
        }
      }
    } else {
      disableStylesheet(alternateStylesheets);
      toggleBodyColorPrimary();
    }
    manageTransitions('#quarto-margin-sidebar .nav-link', true);
    // Switch the toggles
    const toggles = window.document.querySelectorAll('.quarto-color-scheme-toggle');
    for (let i=0; i < toggles.length; i++) {
      const toggle = toggles[i];
      if (toggle) {
        if (alternate) {
          toggle.classList.add("alternate");     
        } else {
          toggle.classList.remove("alternate");
        }
      }
    }
    // Hack to workaround the fact that safari doesn't
    // properly recolor the scrollbar when toggling (#1455)
    if (navigator.userAgent.indexOf('Safari') > 0 && navigator.userAgent.indexOf('Chrome') == -1) {
      manageTransitions("body", false);
      window.scrollTo(0, 1);
      setTimeout(() => {
        window.scrollTo(0, 0);
        manageTransitions("body", true);
      }, 40);  
    }
  }
  const isFileUrl = () => { 
    return window.location.protocol === 'file:';
  }
  const hasAlternateSentinel = () => {  
    let styleSentinel = getColorSchemeSentinel();
    if (styleSentinel !== null) {
      return styleSentinel === "alternate";
    } else {
      return false;
    }
  }
  const setStyleSentinel = (alternate) => {
    const value = alternate ? "alternate" : "default";
    if (!isFileUrl()) {
      window.localStorage.setItem("quarto-color-scheme", value);
    } else {
      localAlternateSentinel = value;
    }
  }
  const getColorSchemeSentinel = () => {
    if (!isFileUrl()) {
      const storageValue = window.localStorage.getItem("quarto-color-scheme");
      return storageValue != null ? storageValue : localAlternateSentinel;
    } else {
      return localAlternateSentinel;
    }
  }
  let localAlternateSentinel = 'alternate';
  // Dark / light mode switch
  window.quartoToggleColorScheme = () => {
    // Read the current dark / light value 
    let toAlternate = !hasAlternateSentinel();
    toggleColorMode(toAlternate);
    setStyleSentinel(toAlternate);
  };
  // Ensure there is a toggle, if there isn't float one in the top right
  if (window.document.querySelector('.quarto-color-scheme-toggle') === null) {
    const a = window.document.createElement('a');
    a.classList.add('top-right');
    a.classList.add('quarto-color-scheme-toggle');
    a.href = "";
    a.onclick = function() { try { window.quartoToggleColorScheme(); } catch {} return false; };
    const i = window.document.createElement("i");
    i.classList.add('bi');
    a.appendChild(i);
    window.document.body.appendChild(a);
  }
  // Switch to dark mode if need be
  if (hasAlternateSentinel()) {
    toggleColorMode(true);
  } else {
    toggleColorMode(false);
  }
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->



</body></html>